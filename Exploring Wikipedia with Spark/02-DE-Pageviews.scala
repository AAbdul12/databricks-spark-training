{"version":"NotebookV1","origId":503877321547014,"name":"02-DE-Pageviews","language":"scala","commands":[{"version":"CommandV1","origId":503877321547016,"guid":"92ea63ea-eac9-4891-95b9-ad02e2ae58f3","subtype":"command","commandType":"auto","position":1.0,"command":"%md #![Spark Logo](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/general/logo_spark.png)\n\n**Objective:**\nAnalyze Desktop vs Mobile traffic to English Wikipedia\n\n**Time to Complete:**\n30 mins\n\n**Data Source:**\npageviews_by_second (<a href=\"http://datahub.io/en/dataset/english-wikipedia-pageviews-by-second\" target=\"_blank\">255 MB</a>)\n\n**Business Questions:**\n* Question # 1) How many rows in the table refer to mobile vs desktop?\n\n**Engineering Questions:**\n* How is the data partitioned? Why is it partitioned the way it is?\n\n**Technical Accomplishments:**\n- Upload a file to Databricks using the Tables UI (optional)\n- Learn how Actions kick off Jobs + Stages\n- Understand how DataFrame partitions relate to compute tasks\n- Use Spark UI to monitor details of Job execution (input read, Shuffle, Storage UI, SQL visualization)\n- Cache a DataFrame to memory (and learn how to unpersist it)\n- Use the following transformations: `orderBy()`, `filter()`\n- Catalyst Optimizer: How DataFrame queries are converted from a Logical plan -> Physical plan\n- Configuration Option: `spark.sql.shuffle.partitions`","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"bc7fb2c5-6e86-4a9e-8b1a-a2f4056ff8a0"},{"version":"CommandV1","origId":503877321547017,"guid":"e9f8ce5d-e6fe-47eb-b883-ff790544edfe","subtype":"command","commandType":"auto","position":2.0,"command":"%md Attach to, and then restart your cluster first to clear out old memory caches and get to a default, standard environment. The restart should take 1 - 2 minutes.\n\n![Restart Cluster](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/general/restart_cluster.png)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"22d0b753-41e1-463f-8149-799b08d4ef26"},{"version":"CommandV1","origId":503877321547018,"guid":"1e8a741c-1548-481b-a4e4-d28136052088","subtype":"command","commandType":"auto","position":3.0,"command":"%md ####![Wikipedia Logo Tiny](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/general/logo_wikipedia_tiny.png) **Introduction: Pageviews By Second**","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"4e136b2c-2b92-44a8-a20c-c89a72d2b839"},{"version":"CommandV1","origId":503877321547019,"guid":"2030fc2a-4d2c-48a8-9472-8db66009d51c","subtype":"command","commandType":"auto","position":4.0,"command":"%md Wikipedia.com is the 7th most popular website (measured by page views and unique visitors):","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"2171a90f-564a-4a5f-be6a-04b978973e61"},{"version":"CommandV1","origId":503877321547020,"guid":"bb82f271-e5de-4224-907f-611ee34aa2bc","subtype":"command","commandType":"auto","position":5.0,"command":"%md #![Top Ten Global Websites2](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/pageviews/top_ten_websites.png)\n\nSource: Alexa/Aug 2015: <a href=\"https://en.wikipedia.org/wiki/List_of_most_popular_websites\" target=\"_blank\">List_of_most_popular_websites</a>","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"b8bf319c-f8ab-44a8-b6f2-eb1273bc5998"},{"version":"CommandV1","origId":503877321547021,"guid":"2e144178-b36d-4014-b23c-6fbbbb3bf7ff","subtype":"command","commandType":"auto","position":6.0,"command":"%md In this notebook, we will analyze the traffic patterns to the desktop vs. mobile editions of English Wikipedia.\n\nThe Wikimedia Foundation has released 41 days of pageviews data starting March 16, 2015 at midnight. Two rows are collected every second:\n- Desktop requests\n- Mobile requests","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"dfa64123-79aa-4da1-975c-30e24643e524"},{"version":"CommandV1","origId":503877321547022,"guid":"068aa61b-c825-4155-a701-ab4517bc5ed1","subtype":"command","commandType":"auto","position":7.0,"command":"%md ####![Databricks Logo Tiny](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/general/logo_databricks_tiny.png) **Pageviews By Second Table**\nBefore we do anything, let's see if our table \"pageviews_by_second\" even exists: run the following cell and we should get a **NoSuchTableException**.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"6406b639-ef24-440a-ac2e-bcbdc69545b8"},{"version":"CommandV1","origId":503877321547023,"guid":"8036761c-6488-4c34-ae79-f5813468861d","subtype":"command","commandType":"auto","position":8.0,"command":"val pageviewsDF = sqlContext.read.table(\"pageviews_by_second\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"af2b41fa-83c5-4806-a2dd-bd9419041e49"},{"version":"CommandV1","origId":503877321547024,"guid":"b31b6d96-ff57-4b44-ba25-9964c3f1d6bf","subtype":"command","commandType":"auto","position":9.0,"command":"%md And just to make sure, let's take a look at the Databrick's Tables UI...","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"e70dd2c7-bc9f-4d37-8344-2b2b24bd6a9d"},{"version":"CommandV1","origId":503877321547025,"guid":"b3fefb8f-584f-4bd1-b8d7-d275863f79b3","subtype":"command","commandType":"auto","position":10.0,"command":"%md ####![Databricks Logo Tiny](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/general/logo_databricks_tiny.png) **Option 1: Upload Pageviews file from your PC to a Databricks Table**\n\nOne option is to \"load\" data directly with the Databrick's UI","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"972b96e2-6b06-4712-a271-4740beb3d42a"},{"version":"CommandV1","origId":503877321547026,"guid":"d709c878-f22e-40c6-b502-7b191182a1a3","subtype":"command","commandType":"auto","position":11.0,"command":"%md ##### Step 1) Download the 46 MB .gz compressed pageviews file to your computer\nNormally we would simply download the 46 MB .gz compressed pageviews file from <a href=\"https://datahub.io/en/dataset/english-wikipedia-pageviews-by-second/resource/6447ff71-bc5c-4c0a-b724-34e117151ee1\" target=\"_blank\">datahub.io</a>\n\n**However**, so that we don't overwhelem the WiFi ware are instead going to use a smaller version of the same file: `pageviews_by_second_example.tsv`","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"e7a51a0b-7119-4adc-b5c1-de4b8c3cb1d7"},{"version":"CommandV1","origId":503877321547027,"guid":"b86a9fe9-86e4-429a-b987-d7a488131a5a","subtype":"command","commandType":"auto","position":12.0,"command":"%md ##### Step 2) Uncompress the pageviews file on your computer\nUncompress the pageviews file on your computer, which will result in a 255 MB CSV file\n\n![Pageviews file](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/pageviews/pageviews_file.png)\n\n**However**, our test file is already decompressed so we can skip this step.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"becae4fe-8d30-4cdd-871a-9e675f54e34f"},{"version":"CommandV1","origId":503877321547028,"guid":"8b8aa7a5-0805-4d0b-908d-e2163caa6395","subtype":"command","commandType":"auto","position":13.0,"command":"%md ##### Step 3) Upload the CSV file to a Databricks table\n\nTo upload the uncompressed file to Databricks, click the **Tables** button, then **Create Table:**\n\n![Create Table](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/pageviews/create_table.png)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"165ac719-04d6-4946-829c-076ea57c8f26"},{"version":"CommandV1","origId":503877321547029,"guid":"1515cd10-fdbb-4a00-9d19-af226115bee8","subtype":"command","commandType":"auto","position":14.0,"command":"%md Before moving forward, let's take a look at the various import options:\n* File\n* S3\n* DBFS\n* JDBC","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"1e9e0bcd-76f9-4597-9cdc-59b0f79af898"},{"version":"CommandV1","origId":503877321547030,"guid":"d8f3a217-d76b-42f4-9fd2-daaee204de00","subtype":"command","commandType":"auto","position":15.0,"command":"%md On the \"Data Import\" page, make sure the Data Source is set to **File** and upload the file:\n\n![Data Import](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/pageviews/data_import.png)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"55f6ad63-1c6f-4392-86b5-4d6b32eda994"},{"version":"CommandV1","origId":503877321547031,"guid":"47b671cf-3fc0-43e0-b70d-8f4349773739","subtype":"command","commandType":"auto","position":16.0,"command":"%md The upload should take 2-5 minutes, depending on your internet connection.\n\n**However**, it should only take a couple of seconds with our example file, `pageviews_by_second_example.tsv`.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"734a03c1-a072-4ad4-9b0e-f3e78abfc99d"},{"version":"CommandV1","origId":503877321547032,"guid":"38354611-edbd-4de2-9034-940af8b071fe","subtype":"command","commandType":"auto","position":17.0,"command":"%md Once the file is uploaded, a \"Preview Table\" button will appear. Click **Preview Table**:\n\n![Preview Table](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/pageviews/preview_table.png)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"ba15fc00-a533-47e0-b484-6047e92bcdc7"},{"version":"CommandV1","origId":503877321547033,"guid":"46e6481a-fdfb-4ff8-9065-7fc8716d6256","subtype":"command","commandType":"auto","position":18.0,"command":"%md The \"Table Details\" will appear. There are 4 steps to do next:\n\n1) Enter the Table Name: **pageviews_by_second_example**\n\n2) Place a check next to **First row is header**\n\n3) Change the **requests** column data type from a STRING to an **INT**\n\n4) Click **Create Table**\n\n![Table Details](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/pageviews/table_details.png)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"5491e60f-0c53-4cd3-acc3-2bbef7992b3d"},{"version":"CommandV1","origId":503877321547034,"guid":"2920ca49-6931-450d-95bb-91fb2da49be2","subtype":"command","commandType":"auto","position":19.0,"command":"%md Finally, you should see the new \"pageviews_by_second_example\" table, with its **Schema** and some **Sample Data**:\n\n![Table GUI](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/pageviews/table_gui.png)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"ea094466-7a2b-481c-b19f-7580aae389e1"},{"version":"CommandV1","origId":503877321547035,"guid":"f31f5877-b5c6-407b-90d4-866e9143d363","subtype":"command","commandType":"auto","position":20.0,"command":"%md Using `sqlContext`, create a DataFrame named `exampleDF` by reading the table you uploaded:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"23e2d841-c9cb-45e8-a834-a0fe3bafc543"},{"version":"CommandV1","origId":503877321547036,"guid":"d8f2597b-8b32-471f-9786-8becee20a7e8","subtype":"command","commandType":"auto","position":21.0,"command":"val exampleDF = sqlContext.read.table(\"pageviews_by_second_example\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"48b085c2-436d-4643-913a-802534a4d88a"},{"version":"CommandV1","origId":503877321547037,"guid":"c18b44b6-76c6-460c-bb03-7cc323401906","subtype":"command","commandType":"auto","position":22.0,"command":"%md Look at the first 5 records in the DataFrame:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"fa78a969-ed77-45a9-bddf-9e6f7c85eca5"},{"version":"CommandV1","origId":503877321547038,"guid":"e069a3a3-b973-4375-981f-4826d4cb7cd5","subtype":"command","commandType":"auto","position":23.0,"command":"// Shows the first 5 records in ASCII print\nexampleDF.show(5)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"8fc00bc5-6ba4-46f4-a36b-e04b0702fb93"},{"version":"CommandV1","origId":503877321547039,"guid":"4253575f-dc35-46ea-af87-5cbd195050c7","subtype":"command","commandType":"auto","position":24.0,"command":"%md ####![Databricks Logo Tiny](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/general/logo_databricks_tiny.png) **Option 2: Use a premounted version of the data (from S3)**\nLet's start by taking another look at what is on our file system: run the following cell and we should see all the datasets from Amazon S3 mounted into our shard:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"d4765247-199d-449c-8012-54586afef4ae"},{"version":"CommandV1","origId":503877321547040,"guid":"aa65003b-9d5f-4fb7-93c5-1e73aac0c79d","subtype":"command","commandType":"auto","position":25.0,"command":"%fs ls /mnt/wikipedia-readonly/","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":1.4773152804E12,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"bmc@databricks.com","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"acf6152d-fe27-4bcf-a61c-d6e5159ef4be"},{"version":"CommandV1","origId":503877321547041,"guid":"8ed956a3-814a-45c3-934e-99312fb14bda","subtype":"command","commandType":"auto","position":26.0,"command":"%md Next, let's take a look in our *pageviews* folder:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"73e94cc2-304f-4210-b431-c77f9662e2e2"},{"version":"CommandV1","origId":503877321547042,"guid":"1afdce5c-ab5b-4790-9131-01dd0b68cbc7","subtype":"command","commandType":"auto","position":27.0,"command":"%fs ls /mnt/wikipedia-readonly/pageviews","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":1.477315418276E12,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"bmc@databricks.com","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"696014a6-ac31-4e33-97a3-6ca13bd0a2a9"},{"version":"CommandV1","origId":503877321547043,"guid":"cbd08537-ff94-4345-9cd8-c2bdecfdf9e7","subtype":"command","commandType":"auto","position":28.0,"command":"%md We can import this file directly with the following command:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"c8d4ec0f-cfed-47aa-986e-ceb62efe510e"},{"version":"CommandV1","origId":503877321547044,"guid":"bedabc19-f97b-4121-b63c-c25666788bdf","subtype":"command","commandType":"auto","position":29.0,"command":"val tempDf = sqlContext.read\n   .format(\"com.databricks.spark.csv\")\n   .option(\"header\", \"true\")        // Use first line of all files as header\n   .option(\"inferSchema\", \"true\")   // Automatically infer data types\n   .option(\"delimiter\", \"\\t\")       // Use tab delimiter (default is comma-separator)\n   .load(\"/mnt/wikipedia-readonly/pageviews/pageviews_by_second.tsv\")\n\ntempDf.registerTempTable(\"pageviews_by_second\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"bffada76-a92c-4de9-badf-8f35d24bb663"},{"version":"CommandV1","origId":503877321547045,"guid":"620164b2-c66f-4d1a-b80a-8326dd791423","subtype":"command","commandType":"auto","position":30.0,"command":"%md Lastly, we can verify that the table was created by using `sqlContext` to create the `pageviewsDF` from the \"temp\" table \"pageviews_by_second\"","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"963b4df4-afcd-44ec-9e62-7c57b692c184"},{"version":"CommandV1","origId":503877321547046,"guid":"a9600375-1711-4124-b11d-5c133d3a78bb","subtype":"command","commandType":"auto","position":31.0,"command":"val pageviewsDF = sqlContext.read.table(\"pageviews_by_second\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"fb50176a-5822-4272-93db-9ff7d47ae213"},{"version":"CommandV1","origId":503877321547047,"guid":"4de417a7-5f93-4b12-8684-0acc7ef7470a","subtype":"command","commandType":"auto","position":32.0,"command":"%md And then we can take a look at the first 10 records.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"79a68f50-075e-4817-a746-b0b00153c1a2"},{"version":"CommandV1","origId":503877321547048,"guid":"4773a3b2-247d-498a-a32e-ac05f1f628ba","subtype":"command","commandType":"auto","position":33.0,"command":"pageviewsDF.show(10)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"139d1175-1f7e-4911-afca-8bfab83396bb"},{"version":"CommandV1","origId":503877321547049,"guid":"bb45db7a-0c70-47f3-98cb-c066f8cea97b","subtype":"command","commandType":"auto","position":34.0,"command":"%md Next, take note that the timestamps and/or sites are out of order, we will dig into this more later.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"448c99cd-df1c-47d8-8a35-467f802d3b70"},{"version":"CommandV1","origId":503877321547050,"guid":"d27e17f7-f55d-473e-b33a-7a78e1f0f9cc","subtype":"command","commandType":"auto","position":35.0,"command":"%md Click the down arrows in the cell above to see that the `show()` action kicked off 1 job and 1 stage.\n\nWe will learn more about Jobs and Stages later in this lab. ","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"7dc9eb05-9b2e-4197-b0e1-9a37a430040a"},{"version":"CommandV1","origId":503877321547051,"guid":"9d941005-4337-4eb1-93b7-af6b372f5efc","subtype":"command","commandType":"auto","position":36.0,"command":"%md `printSchema()` prints out the schema for the table, the data types for each column and whether a column can be null:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"c49d7b30-e38e-4d3f-876b-293b6b4c7a73"},{"version":"CommandV1","origId":503877321547052,"guid":"b24b9fc8-dfc4-4b3c-b846-b604053ce5f7","subtype":"command","commandType":"auto","position":37.0,"command":"pageviewsDF.printSchema","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"ffd256c6-0a38-4e7b-a70d-34fdc8aadae6"},{"version":"CommandV1","origId":503877321547053,"guid":"80254280-28cd-4c6a-85da-421deeb26b0e","subtype":"command","commandType":"auto","position":38.0,"command":"%md Notice above that the first 2 columns are typed as `string`, while the requests column holds an `integer`. ","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"6584ba08-2802-4821-a504-54a690c17f51"},{"version":"CommandV1","origId":503877321547054,"guid":"7f105ba2-c5df-4e2d-a520-59fead89a05c","subtype":"command","commandType":"auto","position":39.0,"command":"%md ####![Spark Logo Tiny](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/general/logo_spark_tiny.png) **Partitions and Tasks**","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"9414616f-6cda-4a59-85fd-e184105f158e"},{"version":"CommandV1","origId":503877321547055,"guid":"d4c794e0-bff4-4bfa-a52e-a25fd32dcd2f","subtype":"command","commandType":"auto","position":40.0,"command":"%md DataFrames are made of one or more partitions.  To see the number of partitions a DataFrame is made of:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"892a5703-ba7b-46d0-b776-4d61f87820ce"},{"version":"CommandV1","origId":503877321547056,"guid":"ea1d41b5-2f6b-42f4-8b44-5d8eb53247e9","subtype":"command","commandType":"auto","position":41.0,"command":"pageviewsDF.rdd.partitions.size","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"60de17b3-3438-4572-9b6e-054722dc1071"},{"version":"CommandV1","origId":503877321547057,"guid":"3e659089-412c-4553-8c20-8ec8d1757dad","subtype":"command","commandType":"auto","position":42.0,"command":"%md The above cell first converts the DataFrame to an RDD, then calls the partitions method followed by the size method on the RDD. We will learn more about RDDs in a future lab. For now, just remember this handy trick to figure out the number of partitions in a DataFrame.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"60ad8ad3-b9e6-4511-924a-2a1a59200435"},{"version":"CommandV1","origId":503877321547058,"guid":"e7cb9555-5533-41f5-a2dc-ee3d04cb59e3","subtype":"command","commandType":"auto","position":43.0,"command":"%md Here is what the DataFrame looks like:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"8f9841e8-9c70-4736-9c30-7d0a604e6020"},{"version":"CommandV1","origId":503877321547059,"guid":"ab26e008-269a-4029-92b4-2d16750dbb8c","subtype":"command","commandType":"auto","position":44.0,"command":"%md ![4 partitions](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/pageviews/4_partitions_dashed.png)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"8a479c3e-d94d-46a8-b958-cefae70795d7"},{"version":"CommandV1","origId":503877321547060,"guid":"2df8cd48-7221-4a79-989d-4c7b465773d3","subtype":"command","commandType":"auto","position":45.0,"command":"%md The dashed lines for the borders indicates that the DataFrame is still on disk and has not been cached into memory.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"e209cebb-d969-4c71-857f-b471cdcf4bed"},{"version":"CommandV1","origId":503877321547061,"guid":"587b3065-4122-472c-b067-41bc2510e80e","subtype":"command","commandType":"auto","position":46.0,"command":"%md Count the number of records (rows) in the DataFrame:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"1fe6c3fd-eedf-48a5-8bf1-d631bb7a3483"},{"version":"CommandV1","origId":503877321547062,"guid":"b97776c5-0f3d-4aa7-9ea6-27f6ec9a30dd","subtype":"command","commandType":"auto","position":47.0,"command":"pageviewsDF.count","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"da4a6135-1c6e-45d4-95dd-cb56f4c05dff"},{"version":"CommandV1","origId":503877321547063,"guid":"1bf27194-ca8a-418e-9a16-a51a4ca27ec6","subtype":"command","commandType":"auto","position":48.0,"command":"%md Let's understand how Spark is actually computing the result of 7.2 million for the count action. It is important to understand the relationship between the number of partitions in a DataFrame and the number of tasks required to process a DataFrame.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"d23287c4-0ae3-499b-85ca-223412d7eb33"},{"version":"CommandV1","origId":503877321547064,"guid":"bd9e0eda-b38c-4500-9628-bfd4b7ffeb4b","subtype":"command","commandType":"auto","position":49.0,"command":"%md In the cell above, where you ran the count, expand the Spark Jobs and Stages:\n\n![Expand Jobs and Stages](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/pageviews/count_jobs_stages_tasks.png)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"934ece54-b1f0-4be8-9750-5f030b95785c"},{"version":"CommandV1","origId":503877321547065,"guid":"2b2f14d1-01b0-4c07-a4ff-01172604544e","subtype":"command","commandType":"auto","position":50.0,"command":"%md Each Spark action (like count) kicks off one or more Jobs. Above we see that one job (Job #2) was launched. *(your specific job # may be different)*\n\nEach job is comprised of one or more Stages. Above we see that two stages (Stage #2 and #3) were launched to compute the result.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"1bd66675-6964-4587-81eb-8599ae7d4548"},{"version":"CommandV1","origId":503877321547066,"guid":"ec26b0a0-f405-4c7a-a61b-2eb6a283a18d","subtype":"command","commandType":"auto","position":51.0,"command":"%md To learn more details about the Job and Stages, open the Spark UI in a new tab:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"c24f0959-f1ae-4651-a9db-878b32393e8a"},{"version":"CommandV1","origId":503877321547067,"guid":"6eacbf60-607f-44c1-8e9d-2085d0a81070","subtype":"command","commandType":"auto","position":52.0,"command":"%md ![Open Spark UI](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/general/view_spark_ui.png)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"1ce60b36-842d-4e36-b8f4-240b1cad72d4"},{"version":"CommandV1","origId":503877321547068,"guid":"0b4107c0-86ba-41df-b81d-783f95356420","subtype":"command","commandType":"auto","position":53.0,"command":"%md When you go to the new \"Spark UI\" tab, you should see the Jobs page, with a few completed jobs. Click on the link under Description for the Job # used to run the count action:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"2fd41511-8f89-4914-aabf-dddf37fefc9e"},{"version":"CommandV1","origId":503877321547069,"guid":"794c3b51-2fc1-4a05-89b4-436d2b8a5031","subtype":"command","commandType":"auto","position":54.0,"command":"%md ![Two Completed Jobs](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/pageviews/three_completed_jobs.png)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"148c8570-2812-4d54-8c8a-c55828f3ebcf"},{"version":"CommandV1","origId":503877321547070,"guid":"4082129e-6dc4-4e97-ad68-4a41079c6b2d","subtype":"command","commandType":"auto","position":55.0,"command":"%md On the \"Details for Job #\" page, you can now see several metrics about the count Job:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"c526c979-29da-4f2a-8c89-660251be1ced"},{"version":"CommandV1","origId":503877321547071,"guid":"4456dcf5-6390-40d9-8667-d398bcff6f80","subtype":"command","commandType":"auto","position":56.0,"command":"%md ![Two Stages Colored](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/pageviews/two_stages_colored.png)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"b4de7207-1102-4948-8372-9aa8485dc4e2"},{"version":"CommandV1","origId":503877321547072,"guid":"4ec36bbe-e5de-402c-b261-f84c49ecc35a","subtype":"command","commandType":"auto","position":57.0,"command":"%md In the screenshot above, we can see (in purple) that Stage 2 (the first Stage for the count job) took 21 seconds to run, while Stage 3 only took 0.2 seconds.\n\nUnder the \"Input\" column, (in green) notice that Stage 2 read about 250 MB of data and (in orange) wrote 168 Bytes of shuffle data.\n\nUnder the \"Shuffle Read\" column, we can also see that Stage 3, (in orange) read the 168 Bytes of data that Stage 2 had written.\n\nTo learn more about the details of Stage 2, click the link (in red) under the Description column for Stage 2:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"bdb78c1d-3b7e-43f6-a084-42c88e9dd5c1"},{"version":"CommandV1","origId":503877321547073,"guid":"f32ec85b-c870-4694-81e4-a12160a1fdc1","subtype":"command","commandType":"auto","position":58.0,"command":"%md On the \"Details for Stage 2\" page, scroll all the way to the bottom till you see the 4 Tasks:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"7bd35830-7727-4287-be75-ab3246ceb215"},{"version":"CommandV1","origId":503877321547074,"guid":"197bdfcf-63cf-44fd-bc0c-4b24567da8f2","subtype":"command","commandType":"auto","position":59.0,"command":"%md ![Stage-1, 4 tasks](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/pageviews/stageone_4tasks.png)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"1e45a5b2-c343-4e6a-b6b9-6e6ab509d854"},{"version":"CommandV1","origId":503877321547075,"guid":"4d61be4d-e7a0-4add-abf9-85d70915765f","subtype":"command","commandType":"auto","position":60.0,"command":"%md In the Tasks screenshot above, we can see (in green) that the first 3 tasks read 64 MB of the file, while the last task read 58 MB of the file. Also notice (in green) that the each of the 64 MB buffers that the first 3 tasks read was comprised of about 1.8 million records, but the last task that read 58 MB only read about 1.6 million records.\n\nWe can also see (in purple) that each task emitted a single 42 Byte record as the Shuffle Write.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"0d2758c2-015a-47a1-852e-41099bbb6ecf"},{"version":"CommandV1","origId":503877321547076,"guid":"77b3a1fa-d57a-42ba-b145-3facbaf8f3fd","subtype":"command","commandType":"auto","position":61.0,"command":"%md When Spark reads CSV files from S3, the input split is 64 MB. That means that Spark will launch a new task/thread to read each 64 MB split of the file. \n\nIn this case, after reading the first three input splits, only 58 MB remain, so the last task reads 58 MB:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"5fa6aa4a-3afb-40b0-bf9c-c21dffb74c08"},{"version":"CommandV1","origId":503877321547077,"guid":"025b2bb1-3432-4b52-8a44-4053e2d07a82","subtype":"command","commandType":"auto","position":62.0,"command":"%md ![64 MB input split](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/pageviews/input_split.png)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"1cf6ff84-7835-42cc-b34d-cbef14ff81bc"},{"version":"CommandV1","origId":503877321547078,"guid":"84ad39bb-f341-4570-83a6-ccd18b28ce31","subtype":"command","commandType":"auto","position":63.0,"command":"%md Click back in your browser to return to the \"Details of Job #\" page, then click on the link under Description to see the details of the next Stage (Stage #3):","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"c6e9fcf6-eaee-47a1-bb0e-ce2e93b7952e"},{"version":"CommandV1","origId":503877321547079,"guid":"116eecab-b48e-4010-a5d2-42655640f733","subtype":"command","commandType":"auto","position":64.0,"command":"%md ![Click Stage 2](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/pageviews/two_stages_clickstagetwo.png)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"d4c6a290-9d77-45e6-85ba-e39602e3a972"},{"version":"CommandV1","origId":503877321547080,"guid":"58c099e6-caa6-49d8-b5fc-ac65f4c13a4e","subtype":"command","commandType":"auto","position":65.0,"command":" %md Once again, scroll all the way to the bottom till you see the 1 Task for Stage 3:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"55b46b23-d35d-42f5-a4e0-2ffba4d67ac5"},{"version":"CommandV1","origId":503877321547081,"guid":"fed55ff3-7426-4012-8a95-d7f8594034c4","subtype":"command","commandType":"auto","position":66.0,"command":"%md ![Stage two, 1 task](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/pageviews/stage2_onetask.png)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"1840f546-898f-46fb-aadf-21e6d5e67fda"},{"version":"CommandV1","origId":503877321547082,"guid":"2670f4bc-8eb8-46cc-863f-75b050031d6e","subtype":"command","commandType":"auto","position":67.0,"command":"%md Notice in the screenshot above, that the single task in Stage 3 read 168 Bytes of data (4 records.)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"a57e545b-4fb8-41bf-8981-b32b65ed2be2"},{"version":"CommandV1","origId":503877321547083,"guid":"d4ca4f4c-d575-40fc-aa4f-1f388cb5d193","subtype":"command","commandType":"auto","position":68.0,"command":"%md The diagram below explains what's going on. The count Job is kicking off two stages. \n\nStage 2 (the first stage of the job) has 4 tasks and each task reads between 1.6 million to 1.8 million records.\n\nEach task in Stage 2 emits one record with the aggregated count that it saw in its local partition of data.\n\nThen all four tasks in Stage 2 complete.\n\nStage 3 (the second stage of the job) starts with only one task. The task reads the 4 records from Stage 2 and performs a final aggregation and emits the number 7.2 million back to our Notebook cell as the final result of the computation!","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"891a8935-02c4-4279-bb84-d481d8739533"},{"version":"CommandV1","origId":503877321547084,"guid":"20e49f6d-88d5-4584-9a51-051ab49b1f0b","subtype":"command","commandType":"auto","position":69.0,"command":"%md ![Count, Physical Model](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/pageviews/count_physicalmodelwjob.png)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"39873432-5f33-42b0-8f7d-0999772b3297"},{"version":"CommandV1","origId":503877321547085,"guid":"ad823da4-cc09-440a-af36-f249efbbdc59","subtype":"command","commandType":"auto","position":70.0,"command":"%md ####![Spark Logo Tiny](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/general/logo_spark_tiny.png) **Transformation: `orderBy()`**","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"5740a162-be03-4891-b8ba-750ba8bfce71"},{"version":"CommandV1","origId":503877321547086,"guid":"5d2155e2-e4c5-4be8-976a-3cde7310bfc8","subtype":"command","commandType":"auto","position":71.0,"command":"%md The `orderBy()` transformation can be used to order the table by the timestamp column:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"c0d91356-9997-485c-ae19-dbb7ab270074"},{"version":"CommandV1","origId":503877321547087,"guid":"4e4aff99-3656-481b-ae88-862c2e5302c7","subtype":"command","commandType":"auto","position":72.0,"command":"pageviewsDF\n  .orderBy($\"timestamp\")  // transformation\n  .show(10)               // action","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"57af045e-61b8-48a3-9afd-3a57a2a93d21"},{"version":"CommandV1","origId":503877321547088,"guid":"de995e29-3ade-40ae-a4ed-a728c35746f9","subtype":"command","commandType":"auto","position":73.0,"command":"%md The first 2 rows show data from March 16, 2015 at **00:00:00** (midnight). \n\nThe 3rd and 4th rows show data from a second after midnight, **00:00:01**.\n\nThe DataFrame contains 2 rows for every second, one for desktop and one for mobile.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"976a4f36-0b9c-4630-89d0-5d7993f686c7"},{"version":"CommandV1","origId":503877321547089,"guid":"7058458a-8084-4446-95c2-c245a21cf6ed","subtype":"command","commandType":"auto","position":74.0,"command":"%md Did you notice that the first 6 rows in the DataFrame are ordered by `desktop`, then `mobile` traffic, but the last 4 rows are ordered by `mobile`, then `desktop`:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"57dc0096-8d8e-45ca-bc6d-a449b04397fa"},{"version":"CommandV1","origId":503877321547090,"guid":"c4f63e8c-c04e-4f13-8c14-71eba6f413d8","subtype":"command","commandType":"auto","position":75.0,"command":"%md ![Out of Order](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/pageviews/out_of_order.png)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"5d3c557d-f29e-45f2-9b74-13f3f89dfd77"},{"version":"CommandV1","origId":503877321547091,"guid":"49cd9b0d-c3a8-476a-8108-f4f93c211240","subtype":"command","commandType":"auto","position":76.0,"command":"%md The following command orders the rows by first the timestamp (ascending), then the site (descending) and then shows the first 10 rows again:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"951f8786-57c3-4a3b-914a-fa21974c3b5d"},{"version":"CommandV1","origId":503877321547092,"guid":"8e472d60-6b4f-46d0-9583-42e3b382d5c4","subtype":"command","commandType":"auto","position":77.0,"command":"pageviewsDF.orderBy($\"timestamp\", $\"site\".desc).show(10)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"3b4aaeab-abdd-4e5f-a504-b5d7d24f7fdb"},{"version":"CommandV1","origId":503877321547093,"guid":"2761d01d-7b9d-4762-a159-aef777708f55","subtype":"command","commandType":"auto","position":78.0,"command":"%md The `orderBy()` transformation takes about 20 seconds to run against the 255 MB pageviews file on S3.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"4c89136e-8c67-4bcb-b68f-57df11f0fe0a"},{"version":"CommandV1","origId":503877321547094,"guid":"33a3f6ed-7eea-40d7-9060-6511107e3998","subtype":"command","commandType":"auto","position":79.0,"command":"%md ####![Spark Logo Tiny](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/general/logo_spark_tiny.png) **Reading from Disk vs Memory**","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"45dd96d7-7e43-4f39-b520-58a74477518c"},{"version":"CommandV1","origId":503877321547095,"guid":"f3ae1766-1ec3-4988-ba45-88fbbf614d62","subtype":"command","commandType":"auto","position":80.0,"command":"%md The 255 MB pageviews file is currently on S3, which means each time you scan through it, your Spark cluster has to read the 255 MB of data remotely over the network.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"84314202-b4b0-4bf2-9356-eb8b2291538f"},{"version":"CommandV1","origId":503877321547096,"guid":"e7ca1051-febb-4d10-9a84-bbe91c662012","subtype":"command","commandType":"auto","position":81.0,"command":"%md Once again, use the `count()` action to scan the entire 255 MB file from disk and count how many total records (rows) there are:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"95e16b3d-1902-4b9c-8873-642df91a567a"},{"version":"CommandV1","origId":503877321547097,"guid":"8b30bb04-fc63-48cc-a6b1-4cbc5247f68d","subtype":"command","commandType":"auto","position":82.0,"command":"pageviewsDF.count","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"dc503b1e-5d0d-4627-b123-3f6a74ad2800"},{"version":"CommandV1","origId":503877321547098,"guid":"6590ac26-ca3e-4501-a064-0d00821bd256","subtype":"command","commandType":"auto","position":83.0,"command":"%md As we saw earlier, the pageviews DataFrame contains 7.2 million rows.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"3a129a30-04e4-4a3b-8f4c-8a6e3a17944b"},{"version":"CommandV1","origId":503877321547099,"guid":"c2a3bca3-509c-45d6-9d42-f6a02bc73e31","subtype":"command","commandType":"auto","position":84.0,"command":"%md Hmm, that took about at least 20 seconds. Let's cache the DataFrame into memory to speed it up.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"c28c7f0f-7d5a-45ee-9d5e-5a52c1cdacd0"},{"version":"CommandV1","origId":503877321547100,"guid":"c4196b7c-0e6e-4b48-a1b6-7f4bb7045b3e","subtype":"command","commandType":"auto","position":85.0,"command":"// This command finishes in less than half a second, because it doesn't actually do the caching yet\n\nsqlContext.cacheTable(\"pageviews_by_second\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"dd6f5c15-98b6-43b4-8e69-41ded1c4c8da"},{"version":"CommandV1","origId":503877321547101,"guid":"9b5729e7-610d-4619-84cb-f2ba5e9c88c7","subtype":"command","commandType":"auto","position":86.0,"command":"%md\nCaching is a lazy operation (meaning it doesn't take effect until you call an action that needs to read all of the data). So let's call the `count()` action again:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"add59b82-7e70-4b09-9473-35d3cbbb4859"},{"version":"CommandV1","origId":503877321547102,"guid":"909ebdbf-dc31-4fe3-b6ea-cafcca50750a","subtype":"command","commandType":"auto","position":87.0,"command":"// During this count() action, the data is read from S3 and counted, and also cached\n// Note that when the count action has to also cache data, it takes longer than simply a count (like above)\n\npageviewsDF.count","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"e5338d26-55b5-4c13-85f4-8144e3da91eb"},{"version":"CommandV1","origId":503877321547103,"guid":"e9669a8d-6ea4-4ee1-b724-fa086df4c4d0","subtype":"command","commandType":"auto","position":88.0,"command":"%md\nThe DataFrame should now be cached, let's run another `count()` to see the speed increase:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"2f0c403f-d983-462b-abf7-5207dcc79ca3"},{"version":"CommandV1","origId":503877321547104,"guid":"af549b9e-f90d-4aea-947a-3946098e843a","subtype":"command","commandType":"auto","position":89.0,"command":"pageviewsDF.count","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"2c99c981-1152-4809-ab79-0957bc980d72"},{"version":"CommandV1","origId":503877321547105,"guid":"16d2a7f5-ee30-49ab-8eb0-b8d3fa76235f","subtype":"command","commandType":"auto","position":90.0,"command":"%md Notice that scanning the DataFrame takes significantly faster!","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"147365cb-5edc-4262-b820-b91a501b4bf9"},{"version":"CommandV1","origId":503877321547106,"guid":"b6741bd4-c37f-4f03-9828-34fe5d778706","subtype":"command","commandType":"auto","position":91.0,"command":"%md Now that the pageviews DataFrame is cached in memory, if you go to the Spark UI tab and click on \"Storage\" (1 in image below) you'll see the \"pageviews_by_second\" DataFrame in memory:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"11210a8b-cd0b-4a1d-8f1d-3ebf0a28e1fc"},{"version":"CommandV1","origId":503877321547141,"guid":"ebd70166-976e-4c05-9f61-c622cbc4468f","subtype":"command","commandType":"auto","position":126.0,"command":"%md ![Notebook + Micro Cluster](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/book_intro/notebook_microcluster.png)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"7b6f391e-64bc-4542-ae0f-68433b30f7ab"},{"version":"CommandV1","origId":503877321547140,"guid":"ca2e1cb9-1078-4155-8005-796e8e0256b7","subtype":"command","commandType":"auto","position":125.0,"command":"%md Recall from the first notebook that your Spark local mode cluster is running with 3 slots:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"9e87258a-90d3-4c4e-955c-ad91c38d7e21"},{"version":"CommandV1","origId":503877321547143,"guid":"96a50ec0-2346-4224-83a5-d3a0e480f8a4","subtype":"command","commandType":"auto","position":128.0,"command":"%md ![Arch 3 slots](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/pageviews/arch_3slots.png)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"7d6ad7e3-ef06-4b21-be0b-ccad5b9a72a4"},{"version":"CommandV1","origId":503877321547142,"guid":"6ff20bc6-7a29-4433-bee7-e59670269433","subtype":"command","commandType":"auto","position":127.0,"command":"%md For best performance, we should cache DataFrames into memory with a number of partitions that is a multiple of the number of slots (3 or 6 or 9, etc). \n\nFor example, here is a DataFrame in memory (orange) with 3 partitions:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"3449fc23-fbee-4bed-b2be-8d158456d0b7"},{"version":"CommandV1","origId":503877321547137,"guid":"3245b871-10c4-417b-8d80-a41f38a7b5ff","subtype":"command","commandType":"auto","position":122.0,"command":"%md ![Catalyst Optimizer](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/pageviews/catalyst.png)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"a5d055bf-057d-4b25-b525-c2454cb89039"},{"version":"CommandV1","origId":503877321547136,"guid":"d030b99c-4c04-4509-8e4b-69e75fe9b00b","subtype":"command","commandType":"auto","position":121.0,"command":"%md At the core of Spark SQL is the Catalyst optimizer, which all DataFrame, SQL and Dataset queries flow through to generate a physical plan that gets executed using RDDs:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"d995a264-2fe1-41e1-968c-2e5e46432bff"},{"version":"CommandV1","origId":503877321547139,"guid":"0c7cfb26-3a82-4a19-bbdb-bda51786868f","subtype":"command","commandType":"auto","position":124.0,"command":"%md ####![Spark Logo Tiny](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/general/logo_spark_tiny.png) **Memory persistence and Shuffle Partitions **","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"73375d50-527d-47bf-9dfb-f28d5e39e41e"},{"version":"CommandV1","origId":503877321547138,"guid":"40475814-0fe5-40b5-932d-8623a9679668","subtype":"command","commandType":"auto","position":123.0,"command":"%md Catalyst is one of the newest and most technically involved components of Spark. It leverages advanced programming language features (e.g. Scala?s pattern matching and quasiquotes) in a novel way to build an extensible query optimizer. \n\nThe main data type in Catalyst is a tree composed of zero or more child node objects. Trees can be manipulated using rules (functions that turn a tree into a new tree). You can read more about how Catalyst works in this Databricks blog post: <a href=\"https://databricks.com/blog/2015/04/13/deep-dive-into-spark-sqls-catalyst-optimizer.html\" target=\"_blank\">April 2015: Deep Dive into Spark SQL?s Catalyst Optimizer</a>","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"9cb1b71d-362b-4147-8580-a42b53295a22"},{"version":"CommandV1","origId":503877321547149,"guid":"5a90eb2a-9368-494e-ae71-d8017ad56ae0","subtype":"command","commandType":"auto","position":134.0,"command":"%md ![Storage UI empty](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/pageviews/storage_empty.png)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"6d7faf96-8b47-43b7-ba88-d0e4819c3fed"},{"version":"CommandV1","origId":503877321547148,"guid":"1cc4a879-f591-4c3e-b6d0-81a4ee60aaae","subtype":"command","commandType":"auto","position":133.0,"command":"%md The Storage UI will now be empty:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"154583f9-941d-43bb-be2a-4bcfad9a631c"},{"version":"CommandV1","origId":503877321547151,"guid":"642020c8-667d-446d-aac8-3ab16dc63dee","subtype":"command","commandType":"auto","position":136.0,"command":"// Type your answer here...","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"6dd2805a-dadb-4dcf-bf49-e5e6a707d4b5"},{"version":"CommandV1","origId":503877321547150,"guid":"97e06c00-349b-4bd1-b29b-1b0dfd110d6d","subtype":"command","commandType":"auto","position":135.0,"command":"%md **Challenge 2:** Reload the table from S3, order it by the timestamp and site column (like above) and cache it:\n\nHint: Name the new DataFrame `pageviewsOrderedDF`","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"cdf9565b-9bf6-4139-b382-0f134bd093a4"},{"version":"CommandV1","origId":503877321547145,"guid":"6ce5b615-2455-482d-a5bd-43f9eaa45669","subtype":"command","commandType":"auto","position":130.0,"command":"%md ![Arch 3 tasks](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/pageviews/arch_3tasks.png)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"da7d0d40-a2bc-436e-89d8-96540294364d"},{"version":"CommandV1","origId":503877321547144,"guid":"0c59bccb-5b76-44d0-be0a-48c728ed1a07","subtype":"command","commandType":"auto","position":129.0,"command":"%md When running transformations on the DataFrame, all 3 partitions can be analyzed in parallel:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"d46ecb57-7288-4713-9b1c-b001a7774f7c"},{"version":"CommandV1","origId":503877321547147,"guid":"8643e76d-d744-45a3-957c-e30735b637c7","subtype":"command","commandType":"auto","position":132.0,"command":"pageviewsDF.unpersist","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"ff807903-82b8-47b1-8e4f-de7968f3d040"},{"version":"CommandV1","origId":503877321547146,"guid":"dcc3de02-37c1-4e89-85f5-50d3ab1928a3","subtype":"command","commandType":"auto","position":131.0,"command":"%md Three seems to be a more ideal number of partitions than four. \n\nFirst, unpersist the original base DataFrame, `pageviewsDF`. Then re-read the 255 MB file from S3, order it by the timestamp column, and re-cache it with 3 partitions:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"b86d93ea-e36f-40d6-afa9-ef96008a2b92"},{"version":"CommandV1","origId":503877321547157,"guid":"82a0ca07-14fb-499a-9a2f-33d50c63685f","subtype":"command","commandType":"auto","position":142.0,"command":"%md ![200 tasks](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/pageviews/200tasks.png)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"3054347f-e659-49b9-b5cb-943b870ed575"},{"version":"CommandV1","origId":503877321547156,"guid":"11ad0942-8e47-4c87-9cd5-a192a42cb77e","subtype":"command","commandType":"auto","position":141.0,"command":"%md What could have happened? Expand the Job details in the `count()` command above by clicking the two down arrows:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"316d650e-8efa-4d74-a5b2-eec8a34317bd"},{"version":"CommandV1","origId":503877321547159,"guid":"0cc024fc-69c9-406a-a73b-4082bc3ed926","subtype":"command","commandType":"auto","position":144.0,"command":"%md By clicking on the Jobs tab in the Spark UI and then clicking into the details for the last job, you can see the same 3 stages:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"3225bb3c-5766-4524-acd2-cdb7616b4701"},{"version":"CommandV1","origId":503877321547158,"guid":"b3a2a0df-c56d-4977-9857-01ed5d351c73","subtype":"command","commandType":"auto","position":143.0,"command":"%md The first stage (Stage 17 above) is reading the 4 input splits from S3. The next Stage seems to be using 200 tasks to do the `orderBy()` transformation (in purple). This is when the DataFrame is being snapshotted and cached into memory. The final stage (Stage 19 above) is doing the final aggregation for the count.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"cc3cd3f6-a817-4793-9a61-c3b5f61d930b"},{"version":"CommandV1","origId":503877321547153,"guid":"4afdf624-949e-4190-b7e3-12152700c5f0","subtype":"command","commandType":"auto","position":138.0,"command":"%md How many partitions are in the new DataFrame?","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"3cf57ae1-5395-4df9-baa9-cf4c3ba77daa"},{"version":"CommandV1","origId":503877321547152,"guid":"dc0e2ad8-b0d3-4a0f-a94b-d5a41f8587d2","subtype":"command","commandType":"auto","position":137.0,"command":"// Materialize the cache\npageviewsOrderedDF.count","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"df6e92f3-f28a-4d60-a94b-7fd0ec88ff22"},{"version":"CommandV1","origId":503877321547155,"guid":"e2215eb2-8b30-4d0e-94ba-32f3238e92bf","subtype":"command","commandType":"auto","position":140.0,"command":"%md #### **200 Partitions!**","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"0e4ba124-204f-4619-9e99-9e9a43f8f282"},{"version":"CommandV1","origId":503877321547154,"guid":"b4181024-00ec-4ae9-b9ab-87cb63b089c8","subtype":"command","commandType":"auto","position":139.0,"command":"pageviewsOrderedDF.rdd.partitions.size","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"47d5f2cd-d2ae-4a0e-8d14-1b1fc2e25513"},{"version":"CommandV1","origId":503877321547165,"guid":"aee08968-e3ae-43f4-af59-9a28a3f00acc","subtype":"command","commandType":"auto","position":150.0,"command":"%md Change the setting to 3:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"1a7f7abc-6ddb-4b9a-8758-e4929c779054"},{"version":"CommandV1","origId":503877321547164,"guid":"26952bba-369d-48db-8269-33d0f1a52675","subtype":"command","commandType":"auto","position":149.0,"command":"%md The option is set to 200. This configures the number of partitions to use when shuffling data for joins or aggregations.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"030de4f3-ef4e-4aa2-8f34-5a58e187c581"},{"version":"CommandV1","origId":503877321547167,"guid":"616fb4fa-ce95-42b6-b44a-d50b303d3544","subtype":"command","commandType":"auto","position":152.0,"command":"%md Verify the change:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"e99c61a9-93d1-4215-aae3-ffb050a69166"},{"version":"CommandV1","origId":503877321547166,"guid":"8d2c8341-5836-4263-a110-b204a4b1dfff","subtype":"command","commandType":"auto","position":151.0,"command":"sqlContext.setConf(\"spark.sql.shuffle.partitions\", \"3\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"a52adfe6-61a9-453b-981f-907c4ce53b06"},{"version":"CommandV1","origId":503877321547161,"guid":"69de4613-ef9c-4a69-9450-c97dd57490e9","subtype":"command","commandType":"auto","position":146.0,"command":"%md Notice that the first stage read 250 MB of input data (in green) and wrote 110 MB of shuffle data (in purple).\n\nThe second stage read the 110 MB of shuffle data from the earlier stage and wrote 8.2 KB of shuffle data (in orange).\n\nThe third stage read the 8.2 KB of shuffle data from the middle stage.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"5b25b04c-ace0-4d12-8912-a1c6c9f40dbc"},{"version":"CommandV1","origId":503877321547160,"guid":"6b9e757f-c2c8-4676-a6e2-bf66c29af6ca","subtype":"command","commandType":"auto","position":145.0,"command":"%md ![3stages_200partitions.png](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/pageviews/3stages_200partitions.png)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"d950141a-70ee-43eb-84ea-186b9d8f34cc"},{"version":"CommandV1","origId":503877321547163,"guid":"144aedfa-a143-4e94-b2c6-5bc032bee445","subtype":"command","commandType":"auto","position":148.0,"command":"sqlContext.getConf(\"spark.sql.shuffle.partitions\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"32a90a36-4495-496c-b73a-b581d062b454"},{"version":"CommandV1","origId":503877321547162,"guid":"cfc4e3f2-37a4-4698-9813-7e4b25047ee8","subtype":"command","commandType":"auto","position":147.0,"command":"%md The trick to understanding what's going on lies in the following Spark SQL configuration option:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"2e4f2fd6-3af8-4c5c-88f5-828795e97a69"},{"version":"CommandV1","origId":503877321547173,"guid":"f6822b59-2e85-4bb4-bcfa-851d2aaf7b49","subtype":"command","commandType":"auto","position":158.0,"command":"%md Expand the Spark Jobs and Job # details in the cell above and note that this time the middle stage only used 3 tasks:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"987a5651-0036-444e-ae21-4bfeb34a0280"},{"version":"CommandV1","origId":503877321547172,"guid":"f79b21ca-3e8e-4e95-9919-516e91a4f591","subtype":"command","commandType":"auto","position":157.0,"command":"// Materialize the cache\npageviewsOrderedDF.count","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"628e05ad-3401-463f-9d50-39465d13a8f6"},{"version":"CommandV1","origId":503877321547175,"guid":"1b717c5e-a28a-4154-9ea9-1a940dd47ec9","subtype":"command","commandType":"auto","position":160.0,"command":"%md Check the size of the DataFrame now:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"79072ad2-e056-4729-b06c-fe8357a3a163"},{"version":"CommandV1","origId":503877321547174,"guid":"2b2933dc-5e65-42f1-90ef-0f2f75880684","subtype":"command","commandType":"auto","position":159.0,"command":"%md ![Middle Stage, 3 Tasks](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/pageviews/middlestage_3tasks.png)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"32340f08-548c-4d0e-a859-0126f1894a94"},{"version":"CommandV1","origId":503877321547169,"guid":"eaa590c3-a4c9-4f94-963c-fba25790fa43","subtype":"command","commandType":"auto","position":154.0,"command":"%md Unpersist the DataFrame and re-run the read/orderBy/cache/count to store the DataFrame in memory with 3 partitions:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"5c3e2861-38e9-44e3-8cfd-e2bccde33bd5"},{"version":"CommandV1","origId":503877321547168,"guid":"94c9f9ff-a9e9-4746-bd2d-4dc05ea6d624","subtype":"command","commandType":"auto","position":153.0,"command":"sqlContext.getConf(\"spark.sql.shuffle.partitions\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"4bc54192-5a9b-4ac4-bf2a-4df4776a89f2"},{"version":"CommandV1","origId":503877321547171,"guid":"e8861c60-1a3a-43da-acfd-7b6203bf71d5","subtype":"command","commandType":"auto","position":156.0,"command":"val pageviewsOrderedDF = sqlContext.read.table(\"pageviews_by_second\").orderBy($\"timestamp\", $\"site\".desc).cache","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"b65dd235-d4d2-42b2-931a-b185f5867329"},{"version":"CommandV1","origId":503877321547170,"guid":"b14cb264-b4f1-4bba-aa2c-b581eb49a8be","subtype":"command","commandType":"auto","position":155.0,"command":"pageviewsOrderedDF.unpersist","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"27e667a3-b046-4889-ac5b-e928b4551b5b"},{"version":"CommandV1","origId":503877321547177,"guid":"20419418-3551-44e2-b894-e93c520cdd63","subtype":"command","commandType":"auto","position":162.0,"command":"%md If you drill into the details of the Spark UI's Storage tab and click on the RDD name, you will now see the DataFrame in memory with 3 partitions:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"0125d244-52ae-40ca-af50-1183415fa1ea"},{"version":"CommandV1","origId":503877321547176,"guid":"9c3ff01a-3c5e-4a75-b0df-ed5cdfe2e8e6","subtype":"command","commandType":"auto","position":161.0,"command":"pageviewsOrderedDF.rdd.partitions.size","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"823c2e1b-3567-4e19-84fc-84c3b1d8471f"},{"version":"CommandV1","origId":503877321547179,"guid":"c431ca8c-f0e6-40d8-be83-b502f9214c24","subtype":"command","commandType":"auto","position":164.0,"command":"%md You can learn more about the different configuration options in Spark SQL in the <a href=\"https://spark.apache.org/docs/latest/sql-programming-guide.html#other-configuration-options\" target=\"_blank\">Apache Spark Docs</a>.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"d70a4daa-67df-4828-a765-f4bd5ddeb560"},{"version":"CommandV1","origId":503877321547178,"guid":"476541d5-2bc7-4d8b-b17d-2d7a26fd09db","subtype":"command","commandType":"auto","position":163.0,"command":"%md ![Storage UI, 3 tasks](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/pageviews/storage_3partitions.png)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"842e1980-4cb1-4e3b-9259-45740be44c8a"},{"version":"CommandV1","origId":503877321547109,"guid":"e12345ee-e25a-406f-b847-1ed930ba3845","subtype":"command","commandType":"auto","position":94.0,"command":"%md ![Storage UI](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/pageviews/storage_ui_details.png)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"9ccc25ac-2bc6-44a4-8775-f668c5bf3a07"},{"version":"CommandV1","origId":503877321547108,"guid":"f0410ed3-3b52-4ee0-baa9-050b6710789f","subtype":"command","commandType":"auto","position":93.0,"command":"%md Notice above that the DataFrame is made of 4 partitions totaling 192 MB in size. \n\nThe Storage Level for DataFrames is actually the new Tungsten Binary format.\n\nClick on the DataFrame name link under the RDD Name column (2 in image above) to see more details about the DataFrame.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"8f1e442c-e527-4108-9410-6cd0989870f6"},{"version":"CommandV1","origId":503877321547111,"guid":"be32f502-4b43-4606-b7c1-0ee54f4ef67d","subtype":"command","commandType":"auto","position":96.0,"command":"%md ![df in memory](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/pageviews/df_in_mem.png)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"194bb971-d1e6-4844-8d39-4b7eb03eeb85"},{"version":"CommandV1","origId":503877321547110,"guid":"f4f51aa3-4dce-4dc6-8b8e-900da96af041","subtype":"command","commandType":"auto","position":95.0,"command":"%md Although the first 3 input splits read from S3 were 64 MB, when they got cached in memory using the Tungsten binary format, they became 49 MB each. The last 58 MB input split became a 44 MB partition in memory:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"483e6c68-5666-42c1-b818-58f9a3811b08"},{"version":"CommandV1","origId":503877321547107,"guid":"fed2b21b-6a76-4d7a-976b-c2e81504c1b1","subtype":"command","commandType":"auto","position":92.0,"command":"%md ![Storage UI](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/pageviews/storage_ui.png)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"69e0665e-f01b-4bad-870a-e29dcf2cdbf1"},{"version":"CommandV1","origId":503877321547117,"guid":"d6e57447-327e-43b7-aad2-dd2c4a6df7ee","subtype":"command","commandType":"auto","position":102.0,"command":"%md **Challenge 1:** How many rows refer to desktop?","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"5621ac7b-e0a1-4918-9a03-d77be966402b"},{"version":"CommandV1","origId":503877321547116,"guid":"d7229795-61eb-43b7-a3d9-7646eea3491c","subtype":"command","commandType":"auto","position":101.0,"command":"%md ![Filter Count Expand](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/pageviews/filter_count_expand.png)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"2128c277-5400-480c-a537-f5b70aac2b85"},{"version":"CommandV1","origId":503877321547119,"guid":"27320ca7-3119-4319-b6d8-2648487c21ca","subtype":"command","commandType":"auto","position":104.0,"command":"%md So, 3.6 million rows refer to the mobile page views and 3.6 million rows refer to desktop page views.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"3154d066-48ad-43fd-8c92-a4c41c196bca"},{"version":"CommandV1","origId":503877321547118,"guid":"98522d9a-2e82-4a02-a57a-1beb6e46ff2d","subtype":"command","commandType":"auto","position":103.0,"command":"// Type your answer here...","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"8eafce34-3cd1-4651-9ac1-e436511e2ed2"},{"version":"CommandV1","origId":503877321547113,"guid":"3f11816b-020b-4dee-82d0-ef43a1b1fd30","subtype":"command","commandType":"auto","position":98.0,"command":"%md Use the `filter()` transformation to keep only the rows where the site column is equal to mobile:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"d9f6ce77-bfb6-48cf-b4b0-a5dc0c4efa17"},{"version":"CommandV1","origId":503877321547112,"guid":"6175dc8a-a223-42b8-b508-ebf7698f3005","subtype":"command","commandType":"auto","position":97.0,"command":"%md ####![Wikipedia + Spark Logo Tiny](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/general/wiki_spark_small.png) Q-1) How many rows in the table refer to mobile vs desktop?","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"a33718a3-467c-4297-94b7-2e6c129e3b79"},{"version":"CommandV1","origId":503877321547115,"guid":"15262adc-1604-4f62-81ea-49c59613f4ff","subtype":"command","commandType":"auto","position":100.0,"command":"%md Expand the Spark Jobs above and notice that even though we added a `filter()` transformation, the Job still requires 2 Stages with 4 tasks in the first Stage and 1 task in the second Stage:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"0e197616-fc3f-47f8-8199-b432456d787b"},{"version":"CommandV1","origId":503877321547114,"guid":"4c0ee890-5d2c-4846-81ee-323de47634fc","subtype":"command","commandType":"auto","position":99.0,"command":"// How many rows refer to mobile?\npageviewsDF.filter($\"site\" === \"mobile\").count","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"42ef3dc4-db7a-424d-ade4-1f024229b4b5"},{"version":"CommandV1","origId":503877321547125,"guid":"fccf9c61-fe76-4c2c-861f-6146fb06ee82","subtype":"command","commandType":"auto","position":110.0,"command":"%md ![Physical Model: Filter and Count](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/pageviews/filter_physical_model.png)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"04e9cc41-d765-48c2-8006-1c5d91f6351f"},{"version":"CommandV1","origId":503877321547124,"guid":"6358cd6f-db63-4ce7-b6af-b5e7b5f40cae","subtype":"command","commandType":"auto","position":109.0,"command":"%md The Physical Model looks different. The filter() + count() job kicks off 2 Stages:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"61925ffe-f9d5-4704-94b0-63044f66a57e"},{"version":"CommandV1","origId":503877321547127,"guid":"4dc5d9c0-eaff-4378-bb85-e4662d24626a","subtype":"command","commandType":"auto","position":112.0,"command":"%md ![Pipelining](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/pageviews/pipelining.png)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"79d831b8-6bb9-4e7f-bfdd-72756ea3d8bb"},{"version":"CommandV1","origId":503877321547126,"guid":"266d8875-f746-48ab-9741-8f0833a69ded","subtype":"command","commandType":"auto","position":111.0,"command":"%md Each of the four tasks in the 1st Stage are actually doing 4 things:\n- Read input split from S3\n- Filter for just mobile or desktop traffic\n- Do a local aggregation on the input split partition\n- Write a single record to local SSD with the count # seen in the partition","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"1fe4c712-ff8a-40fb-a1a9-1045a9ccb5fd"},{"version":"CommandV1","origId":503877321547121,"guid":"dd32d6f0-09a6-4799-bb9c-1b1b8470c1fc","subtype":"command","commandType":"auto","position":106.0,"command":"%md ![Logical Model: Filter](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/pageviews/filter_lazy.png)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"112a2603-d520-4367-afda-1e65212370c6"},{"version":"CommandV1","origId":503877321547120,"guid":"be113462-3114-40d8-8463-95193173185e","subtype":"command","commandType":"auto","position":105.0,"command":"%md Let's compare the above `filter()` + `count()` from a Logical Model vs Physical Model perspective.\n\nReading a DataFrame from a Databricks table and running a filter() on it are both lazy operations, so technically no work is done yet:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"22fbc2d1-4cde-41d3-bd08-21bd8595f6fe"},{"version":"CommandV1","origId":503877321547123,"guid":"a97b1009-43cc-4bbc-bd44-6ed020d6c508","subtype":"command","commandType":"auto","position":108.0,"command":"%md ![Logical Model: Filter and Count](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/pageviews/filter_count_run.png)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"03bd0876-109f-46fa-bd22-12de102f0d61"},{"version":"CommandV1","origId":503877321547122,"guid":"4e4db568-c103-4cd2-a716-28045ffa7649","subtype":"command","commandType":"auto","position":107.0,"command":"%md However, when you call the count() action, it triggers the read from S3, and the filter() and count() to run:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"d439b79c-ad3c-4820-b9e6-517ad6aab82b"},{"version":"CommandV1","origId":503877321547133,"guid":"0ae941cb-daf7-4a14-871a-8c93a66e8d65","subtype":"command","commandType":"auto","position":118.0,"command":"%md In the diagram above, you can see that 7.2 million records are read from memory (green) to create the DataFrame, then filtered for just desktop (or mobile) traffic. The 3.6 million rows that pass the filter are projected out to an aggregator, which outputs 4 records to the Shuffle.\n\nEverything above the TungstenExchange shuffle (in purple) is part of the 1st Stage. After the shuffle, in the 2nd stage, an aggregation is done on 4 input rows to emit 1 output row.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"d2039e3e-558c-4af4-a1e2-2b26d795762d"},{"version":"CommandV1","origId":503877321547132,"guid":"5746c6a5-e517-4933-a9ae-4c4d777fbed2","subtype":"command","commandType":"auto","position":117.0,"command":"%md ![SQL viz](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/pageviews/sql_viz.png)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"80af380c-e2db-4172-b749-2c34f3a93ffc"},{"version":"CommandV1","origId":503877321547135,"guid":"ebdd91a2-5542-4241-ab10-3427c5006a0f","subtype":"command","commandType":"auto","position":120.0,"command":"%md ![SQL details](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/pageviews/sql_details.png)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"6ced0b30-e99c-44f4-97ec-ed74dc042ca2"},{"version":"CommandV1","origId":503877321547134,"guid":"4271c31b-ba35-493b-ae89-1c6f0c55c645","subtype":"command","commandType":"auto","position":119.0,"command":"%md You can expand the \"Details\" in the SQL visualization UI to see the logical and physical plans:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"3a8805a3-9cea-4a4b-83f8-ccfb02e6ca9e"},{"version":"CommandV1","origId":503877321547129,"guid":"80a846bb-32e9-4b53-8660-d9aad6a3c458","subtype":"command","commandType":"auto","position":114.0,"command":"%md Recall that the last command we just ran above was:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"fc47403e-0cfd-4c62-9fa7-5537aad36400"},{"version":"CommandV1","origId":503877321547128,"guid":"e6c341c3-711d-4839-81a3-911912f5a441","subtype":"command","commandType":"auto","position":113.0,"command":"%md ####![Spark Logo Tiny](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/general/logo_spark_tiny.png) ** SQL Query Plan Visualization & the Catalyst Optimizer**","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"ee3b07e7-fc7a-43fc-825d-186902e4e113"},{"version":"CommandV1","origId":503877321547131,"guid":"66ac6565-4101-4bb5-b43c-ad78e13582fc","subtype":"command","commandType":"auto","position":116.0,"command":"%md To see the SQL Query Plan for the `filter()` + `count()` query, click on the SQL tab in the Spark UI:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"fd95ccbc-8d6b-42d3-80ea-50060d9df35c"},{"version":"CommandV1","origId":503877321547130,"guid":"a1922ce6-fae6-4441-ba90-d14776f55999","subtype":"command","commandType":"auto","position":115.0,"command":"//pageviewsDF.filter($\"site\" === \"desktop\").count","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"2aeffc6f-f75f-436d-b6b4-c5fd7596e909"}],"dashboards":[],"guid":"120a60bb-cf72-43fd-82c3-81430c3325d1","globalVars":{},"iPythonMetadata":null,"inputWidgets":{}}